from random import random

from mixer.backend.django import mixer

from sea_battle.utils import extract_ships_from
import pytest


class TestUtilsSortedFleet:

    def test_empty(self):

        data = []
        assert extract_ships_from(data) == []

    @pytest.mark.xfail(raises=TypeError)
    def test_type(self):
        data = [int(), None]
        for i in data:
            extract_ships_from(i)

    def test_general(self):

        fleet = [[0, 5], [0, 5], [0, 5], [1, 0], [1, 1], [1, 2], [1, 3],
                 [2, 7], [2, 8], [2, 9], [3, 0], [3, 4], [4, 0], [5, 0],
                 [5, 3], [5, 7], [6, 7], [7, 4], [8, 1], [8, 4], [8, 4],
                 [8, 9], [9, 1]]

        res = [{(0, 5)},
               {(1, 0), (1, 1), (1, 2), (1, 3)},
               {(2, 7), (2, 8), (2, 9)},
               {(3, 0), (4, 0), (5, 0)},
               {(3, 4)},
               {(5, 3)},
               {(5, 7), (6, 7)},
               {(7, 4), (8, 4)},
               {(8, 1), (9, 1)},
               {(8, 9)}]
        assert extract_ships_from(fleet) == res

    def test_aircraft_carrier_horizontal(self):

        fleet = [[0, 1], [0, 2], [0, 3], [0, 4], [0, 5], [0, 6], [1, 3], [1, 4],
                 [1, 5], [3, 2], [3, 3], [3, 4], [4, 1], [4, 2], [4, 3], [4, 4],
                 [4, 5], [4, 6], [6, 1], [6, 2], [6, 3], [6, 4], [6, 5], [6, 6],
                 [7, 2], [7, 3], [7, 4], [8, 6], [8, 7], [8, 8], [9, 4], [9, 5],
                 [9, 6], [9, 7], [9, 8], [9, 9]]

        res = [{(0, 1), (0, 2), (0, 3), (0, 4), (0, 5), (0, 6), (1, 3), (1, 4), (1, 5)},
               {(3, 2), (3, 3), (3, 4), (4, 1), (4, 2), (4, 3), (4, 4), (4, 5), (4, 6)},
               {(6, 1), (6, 2), (6, 3), (6, 4), (6, 5), (6, 6), (7, 2), (7, 3), (7, 4)},
               {(8, 6), (8, 7), (8, 8), (9, 4), (9, 5), (9, 6), (9, 7), (9, 8), (9, 9)}]
        assert extract_ships_from(fleet) == res

    def test_aircraft_carrier_vertical(self):

        fleet = [[3, 0], [3, 4], [3, 9], [4, 0], [4, 1], [4, 4], [4, 9], [5, 0],
                 [5, 1], [5, 4], [5, 5], [5, 8], [5, 9], [6, 0], [6, 1], [6, 4],
                 [6, 8], [6, 9], [7, 0], [7, 4], [7, 5], [7, 8], [7, 9], [8, 0],
                 [8, 4], [8, 9], [6, 5]]

        res = [{(3, 0), (4, 0), (4, 1), (5, 0), (5, 1), (6, 0), (6, 1), (7, 0), (8, 0)},
               {(3, 4), (4, 4), (5, 4), (5, 5), (6, 4), (6, 5), (7, 4), (7, 5), (8, 4)},
               {(3, 9), (4, 9), (5, 8), (5, 9), (6, 8), (6, 9), (7, 8), (7, 9), (8, 9)}]
        assert extract_ships_from(fleet) == res
